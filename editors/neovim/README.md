<!-- This file is generated by scripts/link-docs.mjs from docs/tinymist/frontend/neovim.typ. Do not edit manually. -->
# Tinymist Neovim Support for Typst

Run and configure tinymist in neovim for Typst.

## Features

See [Tinymist Features](https://github.com/Myriad-Dreamin/tinymist#features) for a list of features.


## Finding Executable

To enable LSP, you must install `tinymist`. You can find `tinymist` by:

- Night versions available at [GitHub Actions](https://github.com/Myriad-Dreamin/tinymist/actions).

- Stable versions available at [GitHub Releases](https://github.com/Myriad-Dreamin/tinymist/releases). 

  If you are using the latest version of
  [typst-ts-mode](https://codeberg.org/meow_king/typst-ts-mode), then
  you can use command `typst-ts-lsp-download-binary` to download the latest
  stable binary of `tinymist` at `typst-ts-lsp-download-path`.

- Build from source by cargo.
  You can also compile and install **latest** `tinymist` by [Cargo](https://www.rust-lang.org/tools/install).

  ```bash
  cargo install --git https://github.com/Myriad-Dreamin/tinymist --locked tinymist
  ```


- (Recommended) Stable versions available with [mason.nvim](https://github.com/williamboman/mason.nvim).

  ```lua
  {
    "williamboman/mason.nvim",
    opts = {
      ensure_installed = {
        "tinymist",
      },
    },
  }
  ```

## Minimal Setup: LazyVim as an Example

This section shows you a minimal way to setup tinymist in Neovim (LazyVim).

1. Copy or merge the [Autocmds file](https://github.com/Myriad-Dreamin/tinymist/tree/main/editors/neovim/config/autocmds.lua) and [Plugin file](https://github.com/Myriad-Dreamin/tinymist/tree/main/editors/neovim/plugins/tinymist.lua) to corresponding paths into `~/.config/nvim/`.

1. Check and restart Neovim.


Please see [Extra Settings](#extra-settings) for more configuration.

## Tips

### Working with Multiple-File Projects

The solution is a bit internal, which should get further improvement, but you can pin a main file by command.

```lua
-- pin the main file
vim.lsp.buf.execute_command({ command = 'tinymist.pinMain', arguments = { vim.api.nvim_buf_get_name(0) } })
-- unpin the main file
vim.lsp.buf.execute_command({ command = 'tinymist.pinMain', arguments = { nil } })
```

There is also a plan to support multiple-file project by workspace configuration, but I don’t know whether it is neovim’s way, so it needs further discussion.

> [!NOTE]
> 
>   `tinymist.pinMain` is a stateful command, and tinymist doesn't remember it between sessions (closing and opening the editor).


## Troubleshooting

### tinymist does not start on creating/opening files

First, please check that tinymist can start with manual file association.

```
:set filetype=typst
```

If tinymist starts, that means you have not made correct file association. If not, there should be some errors in your lspconfig.

Please associate `.typ` file extension to `typst` filetype to start tinymist on creating/opening file events.

```shell
autocmd BufNewFile,BufRead *.typ setfiletype typst
```

## Extra Settings

### Configuring Language Server

To configure language server, you can edit the `opts.servers.tinymist.settings`. For example, if you want to export PDF on typing and output files in `$root_dir/target` directory:

```lua
return {
  -- add tinymist to lspconfig
  {
    "neovim/nvim-lspconfig",
    opts = {
      servers = {
        tinymist = {
          settings = {
            exportPdf = "onType",
            outputPath = "$root/target/$dir/$name",
          }
        },
      },
    },
  },
}
```

See [Tinymist Server Configuration](https://github.com/Myriad-Dreamin/tinymist/tree/main/editors/neovim/Configuration.md) for references.

### Configuring Language Server for COC

To configure language server for [coc.nvim](https://github.com/neoclide/coc.nvim), you can edit the `coc-settings.json` by executing `:CocConfig`:

```json
"languageserver": {
  "tinymist": {
    "command": "tinymist",
    "filetypes": ["typst"],
    "settings": {
      "exportPdf": "onType",
      "outputPath" = "$root/target/$dir/$name",
    }
  }
}
```

### Configuring Folding Range for Neovim Client

Enable LSP-based folding range with `kevinhwang91/nvim-ufo`:

```lua
return {
  { -- configure language servers
    "neovim/nvim-lspconfig",
    dependencies = "kevinhwang91/nvim-ufo", -- enable LSP-based folds
  },
}
```

You can copy or merge [lsp-folding.lua](https://github.com/Myriad-Dreamin/tinymist/tree/main/editors/neovim/plugins/lsp-folding.lua) to corresponding paths into `~/.config/nvim/` and restart Neovim.

## Contributing

You can submit issues or make PRs to [GitHub](https://github.com/Myriad-Dreamin/tinymist).
