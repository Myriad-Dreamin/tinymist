<!-- Basic plugin configuration -->
<idea-plugin>
    <!-- Unique id for the plugin. Must stay constant for the lifetime of the plugin. -->
    <id>org.tinymist.intellij</id>

    <!-- Text to display as name on Settings | Plugins page -->
    <name>Tinymist Typst</name>
    <version>0.1.0</version>

    <!-- Text to display as company information on Settings | Plugins page -->
    <vendor email="tinymist-ij-plugin@jsch.in" url="https://github.com/Myriad-Dreamin/tinymist"> Myriad-Dreamin &amp; Contributors</vendor>

    <!-- Declare dependencies on other plugins or modules -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.redhat.devtools.lsp4ij</depends> <!-- Added dependency for LSP4IJ -->

    <!-- Extension points defined by the plugin. -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Basic language support -->
        <fileType name="Typst file" implementationClass="org.tinymist.intellij.TypstFileType" fieldName="INSTANCE" language="Typst" extensions="typ"/>

        <!-- File editor provider for Text + Preview -->
        <fileEditorProvider implementation="org.tinymist.intellij.preview.TypstTextEditorWithPreviewProvider"/>

        <!-- Register the Folding Builder of LSP4IJ to Typst -->
        <lang.foldingBuilder language="Typst"
                             implementationClass="com.redhat.devtools.lsp4ij.features.foldingRange.LSPFoldingRangeBuilder"
                             order="first"/>
        <!-- LSP textDocument/signatureHelp -->
        <codeInsight.parameterInfo
                language="Typst"
                implementationClass="com.redhat.devtools.lsp4ij.features.signatureHelp.LSPParameterInfoHandler"/>
        <!-- This seems to interfere with textDocument/foldingRange -> disable it for now -->
        <!-- lang.psiStructureViewFactory
                language="Typst"
                implementationClass="com.redhat.devtools.lsp4ij.features.documentSymbol.LSPDocumentSymbolStructureViewFactory"/ -->
        <!-- this is not supported by tinymist -->
        <!-- callHierarchyProvider
                language="Typst"
                implementationClass="com.redhat.devtools.lsp4ij.features.callHierarchy.LSPCallHierarchyProvider" / -->

        <!-- Settings -->
        <applicationService serviceImplementation="org.tinymist.intellij.settings.TinymistSettingsService"/>
        <applicationConfigurable parentId="tools" instance="org.tinymist.intellij.settings.TinymistSettingsConfigurable" id="org.tinymist.intellij.settings.TinymistSettingsConfigurable" displayName="Tinymist LSP"/>

    </extensions>

    <!-- LSP4IJ specific extensions -->
    <extensions defaultExtensionNs="com.redhat.devtools.lsp4ij">
        <server id="tinymistServer"
                name="Tinymist Language Server" 
                factoryClass="org.tinymist.intellij.lsp.TinymistLanguageServerFactory">
            <description><![CDATA[
            Provides Typst language intelligence via the tinymist LSP.
            ]]></description>
        </server>
        <languageMapping language="Typst"
                         serverId="tinymistServer"
                         languageId="typst"/>

        <fileNamePatternMapping patterns="*.typ"
                                serverId="tinymistServer"
                                languageId="typst"/>
    </extensions>

    <actions>
    </actions>

</idea-plugin> 